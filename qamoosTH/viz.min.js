function setup(){myCanvas=createCanvas(.97*windowWidth,.97*windowHeight),myCanvas.parent("theCanvas"),termTextHtml=select("#termText"),termTextAreaHtml=select("#termTextArea"),ellipseMode(RADIUS),smooth(),strokeWeight(1),textSize(12),textFont("NotoKufi"),pal=[color(74,139,115,175),color(37,93,108,175),color(92,93,136,175),color(59,137,201,175)],N=words.length,d=Drough,R=height/3.25,Cx=2.5*windowWidth/100+width/2;for(var a=0;a<N;a++)t[a]=words[a].term,theta[a]=a*TWO_PI/N,x[a]=Cx+1.1*R*cos(theta[a]),y[a]=height/2+1.1*R*sin(theta[a]);stroke(0),noFill(),hostLoc=window.location.href,hostLoc.indexOf("#")>0?(loadId=hostLoc.indexOf("about")>0?126:parseInt(hostLoc.substring(hostLoc.indexOf("#")+1)),console.log(loadId),hostLoc=hostLoc.substring(0,hostLoc.indexOf("#")),console.log(hostLoc)):loadId=-1}function chordAll(){isChordAll=!0,select("#englishLink").style("visibility","visible"),background(255),textSize(12),pal=[color(74,139,115,opac),color(37,93,108,opac),color(92,93,136,opac),color(59,137,201,opac)],dThetaN=TWO_PI/(2*N),noFill();for(var a=0;a<N;a++){stroke(pal[words[a].cat-1]);for(var b=0;b<N;b++)d[a][b]>2&&(strokeWeight(d[a][b]/25),bezier(x[a],y[a],Cx,height/2,Cx,height/2,x[b],y[b]));push(),noStroke(),fill(0),translate(Cx,height/2),rotate(theta[a]),translate(1.2*R,0),textAlign(LEFT,CENTER),a>floor(N/4)&&a<floor(3*N/4)&&(translate(0,2),rotate(PI),textAlign(RIGHT,CENTER)),text(t[a],0,0),pop(),push(),translate(Cx,height/2),rotate(theta[a]),translate(1.12*R,0),fill(pal[words[a].cat-1],10),strokeWeight(1.5),noStroke(),pop()}}function chordAllSelect(){if(rTheta=cartesToPolar(mouseX,mouseY,Cx,height/2,0),rTheta[0]>.3*R&&rTheta[0]<2*R?(currentTerm=int(N*(dThetaN+rTheta[1])/TWO_PI)%N,opac=0):(currentTerm=null,opac=175),chordAll(),null!=currentTerm){var a=currentTerm,b=max(d[a]);stroke(30),pal=[color(74,139,115),color(37,93,108),color(92,93,136),color(59,137,201)],stroke(pal[words[a].cat-1]);for(var c=0;c<N;c++)d[a][c]&&(d[a][c]<b/2||b<6?strokeWeight(2):strokeWeight(4),bezier(x[a],y[a],Cx,height/2,Cx,height/2,x[c],y[c]));push(),noStroke(),fill(0),translate(Cx,height/2),rotate(theta[a]),translate(1.2*R,0),textAlign(LEFT,CENTER),a>floor(N/4)&&a<floor(3*N/4)&&(translate(0,2),rotate(PI),textAlign(RIGHT,CENTER)),fill(255),text(t[a],0,0),text(t[a],0,0),text(t[a],0,0),fill(0),textFont("NotoKufiBold"),text(t[a],0,0),pop(),push(),fill(0),translate(Cx,height/2),rotate(theta[a]),translate(1.15*R,0),fill(0),stroke(0),ellipse(0,0,1.5,1.5),pop()}}function chordOne(a){isChordAll=!1,nFrames=0,select("#englishLink").style("visibility","hidden");var b=a;incoming=[],nNew=1,thetaEnd=[],thetaMove=[],xNew=[],yNew=[],tNew=[],strokeNew=[],strokeOut=color(0,100,100),strokeIn=color(0,100,100),originalN=[],originalN[0]=b,tNew[0]=t[b],thetaEnd[0]=0,thetaMove[0]=theta[b],xNew[0]=x[b],yNew[0]=y[b],strokeNew[0]=color(0),incoming[0]=!1;for(var c=max(d[b]),e=0;e<N;e++)0!=d[b][e]&&(nNew++,originalN.push(e),incoming.push(!0),tNew.push(t[e]),strokeNew.push(map(d[b][e],1,c,1,4)));R1=width/12,W1=1.75*width/10,H1=.33*height,dThetaN=TWO_PI/(2*originalN.length),backTerms.push(b)}function chordOneDraw(){if(nFrames<totalFrames){textSize(map(nNew,1,26,13,10)),nNew>25&&textSize(9),textFont("NotoKufi"),background(255),noFill();for(var a=0;a<nNew;a++)thetaEnd[a]=(thetaEnd[0]+a*TWO_PI/nNew)%TWO_PI,thetaMove[a]=map(nFrames,0,totalFrames,0,thetaEnd[a]),nFrames+3>totalFrames&&(thetaMove[a]=thetaEnd[a]),xNew[a]=W1+R1*cos(thetaMove[a]),yNew[a]=H1+R1*sin(thetaMove[a]),strokeWeight(strokeNew[a]),incoming[a]?stroke(strokeIn):stroke(strokeOut),a>0&&bezier(xNew[0],yNew[0],W1,H1,W1,H1,xNew[a],yNew[a]);for(var a=0;a<nNew;a++)push(),noStroke(),translate(W1,H1),rotate(thetaMove[a]),translate(1.1*R1,0),0==a&&(fill(strokeOut),ellipse(0,0,4,4)),fill(0),translate(.1*R1,0),textAlign(LEFT,CENTER),thetaMove[a]>TWO_PI/4&&thetaMove[a]<3*TWO_PI/4&&(translate(0,2),rotate(PI),textAlign(RIGHT,CENTER)),text(tNew[a],0,0),pop();if(nFrames+3>totalFrames){window.location.replace(hostLoc+"#"+originalN[0]),select("#textBox").style("visibility","visible"),select("#linkBox").style("visibility","visible"),select("#aboutLink").style("visibility","visible");var b="data/txt/"+(originalN[0]+1)+".txt",c="data/pdfs/"+(originalN[0]+1)+".pdf";document.getElementById("downLink").href=c,loadStrings(b,showTermText),showLinks(),select("#zoom-photo").style("visibility","visible"),zoomPhoto=!0,document.getElementById("zoomInPhoto").src="img/graphs/graph"+(originalN[0]+1)+".png",tNew.length>11?document.getElementById("linkBox").style.paddingRight="0.75em":document.getElementById("linkBox").style.paddingRight="1.0em"}nFrames++}}function showTermText(a){termText="<p>"+a.join("</p><p>")+"</p>";termTextHtml.html(termText),document.getElementById("termTextArea").scrollTop=0,select("#title").html(tNew[0])}function showLinks(){for(var a="",b=1;b<tNew.length;b++)a+='<a href="#'+originalN[b]+'" onClick="listTermClick('+b+')" >'+tNew[b]+"</a> <br/>";select("#linkBox").html(a),document.getElementById("linkBox").scrollTop=0}function listTermClick(a){var b=a;about?cancelAbout():b=originalN[b],nFrames=0,chordOne(b)}function previousTerm(){if(about&&cancelAbout(),backTerms.length>1){backTerms.pop();var a=backTerms[backTerms.length-1];nFrames=0,backTerms.pop(),chordOne(a)}}function cancelAbout(){about=!1,document.getElementById("linkBox").style.maxHeight="30vh",select("#theCanvas").style("visibility","visible"),select("#listTitle").style("visibility","hidden"),select("#downLink").style("visibility","visible")}function showAbout(){about=!0,window.location.replace(hostLoc+"#about");var a="data/about.txt";loadStrings(a,showAboutText);var b="عن القاموس";b+="&nbsp;&nbsp;&nbsp;&nbsp;<a href='https://www.facebook.com/RevolutionDictionary/' target ='_blank'> <img src='icns/facebook-4-24.png' /></a> &nbsp; <a href='https://twitter.com/qamosalthawra' target ='_blank'> <img src='icns/twitter-4-24.png' /></a> &nbsp; <a href='https://soundcloud.com/qamos-al-thawra' target ='_blank'> <img src='icns/soundcloud-4-24.png' /></a>",select("#title").html(b),document.getElementById("linkBox").style.maxHeight="70vh";for(var c="",d=0;d<N;d++)c+='<a href="#'+d+'" onClick="listTermClick('+d+')" >'+t[d]+"</a> <br/>";select("#linkBox").html(c),select("#theCanvas").style("visibility","hidden"),select("#listTitle").style("visibility","visible"),select("#zoom-photo").style("visibility","hidden"),select("#downLink").style("visibility","hidden"),zoomPhoto=!1}function showAboutText(a){var b="<p>"+a.join("")+"</p>";termTextHtml.html(b),document.getElementById("termTextArea").scrollTop=0}function draw(){"complete"===document.readyState&&frameCount>60&&frameCount<65&&chordAll(),loadId>=0&&frameCount>120&&loadIdWorkAround(),!isChordAll&&nFrames<totalFrames&&chordOneDraw()}function mouseMoved(){isChordAll&&frameCount>65?chordAllSelect():(rTheta=cartesToPolar(mouseX,mouseY,W1,H1,thetaEnd[0]),rTheta[0]<1.33*R1&&(push(),translate(W1,H1),noFill(),stroke(255),strokeWeight(6),ellipse(0,0,1.1*R1,1.1*R1),currentTerm=abs(int(originalN.length*(dThetaN+rTheta[1])/TWO_PI)%originalN.length),rotate(thetaEnd[0]),translate(1.1*R1,0),stroke(0,100,100),strokeWeight(1),ellipse(0,0,3,3),pop(),push(),translate(W1,H1),rotate(thetaEnd[currentTerm]),translate(1.1*R1,0),fill(0,100,100),noStroke(),ellipse(0,0,2,2),pop()))}function mouseReleased(){var a=!1;if(rTheta[0]<1.5*R1&&(about||zoomPhoto||(a=!0),zoomPhoto&&rTheta[0]>.5*R1&&(a=!0)),isChordAll&&null!=currentTerm){var b=currentTerm;nFrames=0,chordOne(b)}else if(a){var b=currentTerm;b=originalN[b],nFrames=0,chordOne(b)}}function loadIdWorkAround(){if(loadId<125){var a=loadId;nFrames=0,chordOne(a),loadId=-1}else 126==loadId?(nFrames=0,chordOne(0),loadId++):(loadId++,loadId>200&&(showAbout(),loadId=-1))}function cartesToPolar(a,b,c,d,e){var f=[];return a-=a<c?c:c,b=b<d?d-b:-(b-d),f[0]=sqrt(a*a+b*b),f[1]=(atan2(-b,a)-e)%TWO_PI,f[1]<0?f[1]+=TWO_PI:f[1]>TWO_PI&&(f[1]-=TWO_PI),f}var isChordAll=!0,N,n=[],h=[],t=[],Cx,W1,H1,R1,d=[],rndData=[],names=[],theta=[],x=[],y=[],R,hostLoc="",loadId=0,backTerms=[],namesP,fontAR,pal=[],t0=0,nFrames=0,totalFrames=50,termText,termTextAreaHtml,termTextHtml,zoomPhoto=!1,about=!1,aboutText="",myCanvas,opac=175,incoming=[],nNew=1,thetaEnd=[];thetaEnd[0]=0;var thetaMove=[],xNew=[],yNew=[],tNew=[],strokeNew=[],strokeOut,strokeIn,originalN=[],dThetaN,rTheta=0,rThetaPrev=0,currentTerm;
